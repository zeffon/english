---
sidebar_position: 1
sidebar_label: 标记训练
title: ''
slug: /marking/train
---

import { useRef, useState, useEffect } from 'react'
import { useSize } from 'ahooks'
import BilibiliEmbedRenderer from 'react-bilibili-embed-renderer'
import { calcBiliPlayCount, calcBiliVideoDate, scrollToTop } from '@site/src/utils/helper'
import styles from './mark-train-styles.module.css'
import BiliVideoCardStatsIcon from '@site/static/img/bili-video-card-stats-icon.svg'

export const BiliAudioView = ({ item }) => {
  const ref = useRef(null)
  const size = useSize(ref)
  return (
    <>
      {item && (
        <div ref={ref} className={styles.BiliAudioView} id="bili-audio">
          <BilibiliEmbedRenderer
            aid={item.aid}
            width={size && size.width}
            iframeClass={styles.AudioContainer}
          ></BilibiliEmbedRenderer>
        </div>
      )}
    </>
  )
}

export const BiliVideoCardContainer = ({ list, curIndex, setIndex, page, setPage }) => {
  const selectItem = (index) => {
    setIndex(index)
    scrollToTop()
  }
  const changePage = (pn) => {
    setPage({ pn })
    scrollToTop()
  }
  return (
    <>
      <div className={styles.BiliVideoCardList}>
        {list.map((item, index) => {
          return (
            <div
              onClick={() => selectItem(index)}
              key={item.aid}
              className={`${styles.BiliVideoCard} ${
                index === curIndex && styles.BiliVideoCardSelected
              }`}
            >
              <div className={styles.BiliVideoCardImgWarp}>
                <img className={styles.BiliVideoCardImg} src={item.pic} />
                <div className={styles.BiliVideoCardStats}></div>
                <BiliVideoCardStatsIcon
                  className={styles.BiliVideoCardStatsIcon}
                ></BiliVideoCardStatsIcon>
                <span className={styles.BiliVideoCardStatsCount}>
                  {calcBiliPlayCount(item.play)}
                </span>
                <span className={styles.BiliVideoCardStatsDuration}>{item.length}</span>
              </div>
              <div className={styles.BiliVideoCardInfo}>
                <div>{item.title}</div>
                <div className={styles.BiliVideoCardInfoAuthor}>
                  {item.author} &nbsp;{calcBiliVideoDate(item.created)}
                </div>
              </div>
            </div>
          )
        })}
      </div>
      <div
        className={`${styles.BiliVideoPagination} ${
          page.count <= page.ps && styles.BiliVideoPaginationDisabled
        }`}
      >
        <div
          className={`${page.pn === 1 && styles.BiliVideoPaginationHidden}`}
          onClick={() => changePage(page.pn - 1)}
        >
          上一页
        </div>
        <div
          className={`${page.count <= page.pn * page.ps && styles.BiliVideoPaginationHidden}`}
          onClick={() => changePage(page.pn + 1)}
        >
          下一页
        </div>
      </div>
    </>
  )
}

export const MarkingTrain = () => {
  const [list, setList] = useState([])
  const [curIndex, setIndex] = useState(0)
  const [page, setPage] = useState({ count: 0, pn: 1, ps: 30 })
  const [errorMsg, setErrorMsg] = useState('')
  useEffect(async () => {
    const response = await fetch(
      `https://english.zeffon.cn/spider/v1/bilibili/audio?page=${page.pn}&count=30&mid=131058159`
    )
    const json = await response.json()
    const code = json.code
    if (code === 0) {
      setList(json.list)
      setPage(json.page)
    } else {
      setErrorMsg(json.message)
    }
  }, [page.pn])
  return (
    <>
      <meta name="referrer" content="no-referrer" />
      {errorMsg ? (
        <div className={styles.BilibiliErrorMsg}>请求Bilibili接口异常：{errorMsg}</div>
      ) : (
        <div>
          <BiliAudioView item={list[curIndex]}></BiliAudioView>
          <BiliVideoCardContainer
            list={list}
            curIndex={curIndex}
            setIndex={setIndex}
            page={page}
            setPage={setPage}
          ></BiliVideoCardContainer>
        </div>
      )}
    </>
  )
}

:::tip

以下视频内容是来自 B 站的[**`英语老师Lee`**](https://space.bilibili.com/131058159)的语音标记视频。

:::

<MarkingTrain></MarkingTrain>
